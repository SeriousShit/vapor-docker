pipeline:

  test-builder:
    group: test
    image: plugins/docker
    repo: waddle/vapor-builder
    dockerfile: Dockerfile-builder
    secrets: [ docker_username, docker_password ]
    force_tag: false
    when:
        branch: [ develop, feature/*]

  test-runner:
    group: test
    image: plugins/docker
    repo: waddle/vapor-builder
    dockerfile: Dockerfile-runner
    secrets: [ docker_username, docker_password ]
    force_tag: false
    when:
        branch: [ develop, feature/*]

  builder:
    group: build
    image: plugins/docker
    repo: waddle/vapor-builder
    tags: latest
    dockerfile: Dockerfile-builder
    secrets: [ docker_username, docker_password ]
    when:
        branch: master
    
  runner:
    group: build
    image: plugins/docker
    repo: waddle/vapor-runner
    tags: latest
    dockerfile: Dockerfile-runner
    secrets: [ docker_username, docker_password ]
    when:
        branch: master